---
transition: fade
auto-animate: true
---

# API07 — SSRF prevention

<div class="mb-6">
  <div>
    <div class="mb-4 text-xl font-semibold">
      Fetch external data <span v-mark.orange="1">with destination control</span>
    </div>
    <div class="flex items-center justify-center gap-4 text-lg">
      <div class="px-5 py-4 rounded-lg border border-white/20 text-center">
        <div class="font-semibold">User</div>
        <div class="text-sm opacity-70 mt-1">
          Requests external data
        </div>
      </div>
      <div class="text-3xl opacity-60">→</div>
      <div class="px-5 py-4 rounded-lg border border-green-400/60 text-center">
        <div class="font-semibold text-green-400">API</div>
        <div class="text-sm opacity-80 mt-1">
          <span v-mark.green="2"> Validates destination </span><br/>
          Allowlist enforced
        </div>
      </div>
      <div class="text-3xl opacity-60">→</div>
      <div class="px-5 py-4 rounded-lg border border-green-400/60 text-center">
        <div class="font-semibold text-green-400">External API</div>
        <div class="text-sm opacity-80 mt-1">
          Approved partner<br/>
          Public service only
        </div>
      </div>
    </div>
  </div>
</div>


````md magic-move {lines: true}
```ts {*}
app.post('/fetch', async (req, res) => {
  const response = await axios.get(req.body.url);
  res.send(response.data);
});
```

```ts {1,6-8|*}
const allowedHosts = ['api.partner.com'];

app.post('/fetch', async (req, res) => {
  const url = new URL(req.body.url);

  if (!allowedHosts.includes(url.hostname)) {
    throw new ForbiddenError();
  }

  const response = await axios.get(url.toString());
  res.send(response.data);
});
```
````